import jwt
from jwt import PyJWKClient

def verify_token(tenant_id, client_id, token):
    jwks_url = f"https://login.microsoftonline.com/{tenant_id}/discovery/v2.0/keys"
    issuer = f"https://login.microsoftonline.com/{tenant_id}/v2.0"

    jwks_client = PyJWKClient(jwks_url)
    signing_key = jwks_client.get_signing_key_from_jwt(token)

    claims = jwt.decode(
        token,
        signing_key.key,
        algorithms=["RS256"],
        audience=client_id,
        issuer=issuer,
    )
    return claims
