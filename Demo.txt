import os
import pandas as pd

def consolidate_excel_files(folder_path, output_file):
    """
    Consolidates all Excel files in a folder into a single Excel file with each file's content
    placed in a separate sheet named after the file.

    Args:
        folder_path (str): Path to the folder containing Excel files.
        output_file (str): Path for the consolidated output Excel file.

    Returns:
        None
    """
    # Create a writer object
    writer = pd.ExcelWriter(output_file, engine='openpyxl')

    # Iterate over all files in the folder
    for file_name in os.listdir(folder_path):
        file_path = os.path.join(folder_path, file_name)
        # Check if the file is an Excel file
        if file_name.endswith(('.xlsx', '.xls')) and os.path.isfile(file_path):
            try:
                # Read the Excel file
                data = pd.read_excel(file_path)
                # Remove the extension from the file name for the sheet name
                sheet_name = os.path.splitext(file_name)[0][:31]  # Sheet names have a max length of 31
                # Write to the Excel writer object
                data.to_excel(writer, index=False, sheet_name=sheet_name)
            except Exception as e:
                print(f"Could not process {file_name}: {e}")

    # Save the consolidated Excel file
    writer.save()
    print(f"Consolidated file saved as {output_file}")
