import requests
from jose import jwt
from jose.exceptions import JWTError, ExpiredSignatureError, JWTClaimsError

# Azure Entra (AAD) tenant ID
TENANT_ID = 'your-tenant-id'
CLIENT_ID = 'your-app-client-id'  # This is the Application (client) ID of your app
AUTHORITY = f'https://login.microsoftonline.com/{TENANT_ID}'
JWKS_URL = f'{AUTHORITY}/discovery/v2.0/keys'
ISSUER = f'{AUTHORITY}/v2.0'

def get_jwks():
    response = requests.get(JWKS_URL)
    response.raise_for_status()
    return response.json()

def verify_token(token: str):
    jwks = get_jwks()
    try:
        # Decode and validate the token
        claims = jwt.decode(
            token,
            jwks,
            algorithms=['RS256'],
            audience=CLIENT_ID,
            issuer=ISSUER
        )
        print("Token is valid.")
        print("Claims:", claims)
        return claims
    except ExpiredSignatureError:
        print("Token has expired.")
    except JWTClaimsError as e:
        print("Invalid claims:", e)
    except JWTError as e:
        print("Token verification failed:", e)
    return None

# Example usage
bearer_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...'  # Replace with your token
verify_token(bearer_token)
