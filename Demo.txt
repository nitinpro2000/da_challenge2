import requests
import streamlit as st

# Jira API credentials and endpoint
JIRA_URL = "https://your-domain.atlassian.net/rest/api/2/search"
API_KEY = "your_api_key"
EMAIL = "your_email@example.com"

# Function to fetch user stories from Jira
def fetch_user_stories():
    headers = {
        "Authorization": f"Basic {EMAIL}:{API_KEY}",
        "Content-Type": "application/json"
    }
    query = {
        "jql": "issuetype = 'Story'",  # Filter only 'Story' type issues
        "fields": "key"  # Only fetch the 'key' field (story IDs)
    }
    response = requests.get(JIRA_URL, headers=headers, params=query)
    
    if response.status_code == 200:
        issues = response.json().get("issues", [])
        return [issue["key"] for issue in issues]  # Extract story IDs
    else:
        st.error(f"Failed to fetch user stories: {response.status_code}")
        return []

# Streamlit UI
def main():
    st.title("Jira User Story Selector")

    # Fetch user stories
    with st.spinner("Fetching user stories..."):
        story_ids = fetch_user_stories()

    if story_ids:
        # Create a dropdown to select story ID
        selected_story = st.selectbox("Select a User Story ID:", story_ids)
        st.success(f"Selected Story ID: {selected_story}")
    else:
        st.warning("No user stories found.")

if __name__ == "__main__":
    main()
